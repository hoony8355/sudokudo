<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>스도쿠 점령전</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #f2f2f2;
    }
    h1 {
      margin-top: 2vmin;
    }
    #game-start, #difficulty-select, #board, #scoreboard, #numpad {
      margin-top: 2vmin;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      width: 90vmin;
      height: 90vmin;
      border: 2px solid #000;
      box-sizing: border-box;
    }
    .cell {
      border: 1px solid #ccc;
      font-size: 3vmin;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      box-sizing: border-box;
    }
    .fixed {
      background: #eee;
      font-weight: bold;
    }
    .claimed-blue {
      background-color: rgba(0, 120, 255, 0.3);
    }
    .claimed-red {
      background-color: rgba(255, 0, 0, 0.3);
    }
    .selected-cell {
      outline: 2px solid #666;
    }
    #numpad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1vmin;
      width: 90vmin;
    }
    .num-button {
      padding: 4vmin;
      font-size: 4vmin;
      background: #fff;
      border: 1px solid #aaa;
      border-radius: 0.5vmin;
    }
    #scoreboard {
      font-size: 3vmin;
    }
    button {
      font-size: 4vmin;
      padding: 1vmin 3vmin;
      margin: 2vmin;
    }
  </style>
</head>
<body>
  <h1>스도쿠 점령전</h1>
  <div id="game-start">
    <button onclick="showDifficulty()">게임 시작</button>
  </div>

  <div id="difficulty-select" style="display:none">
    <button onclick="startGame('easy')">초급</button>
    <button onclick="startGame('medium')">중급</button>
    <button onclick="startGame('hard')">고급</button>
  </div>

  <div id="scoreboard" style="display:none">점령한 칸: <span id="score">0</span>/81</div>
  <div id="board"></div>
  <div id="numpad" style="display:none"></div>

  <script src="https://cdn.jsdelivr.net/npm/sudoku@1.0.3/sudoku.min.js"></script>
  <script>
    let selectedCell = null;
    let puzzle = [];
    let answer = [];
    let correctCount = 0;
    let claimed = {};
    let myUid = "tester";  // 테스트용
    let myColor = "blue";
    let currentDifficulty = "easy";

    function showDifficulty() {
      document.getElementById("game-start").style.display = "none";
      document.getElementById("difficulty-select").style.display = "block";
    }

    function startGame(difficulty) {
      currentDifficulty = difficulty;
      const raw = sudoku.generate(difficulty);
      const solved = sudoku.solve(raw);
      puzzle = raw.split('').map(c => c === '.' ? 0 : parseInt(c));
      answer = solved.split('').map(c => parseInt(c));
      renderBoard();
      document.getElementById("difficulty-select").style.display = "none";
      document.getElementById("scoreboard").style.display = "block";
      document.getElementById("numpad").style.display = "grid";
    }

    function renderBoard() {
      const board = document.getElementById("board");
      board.innerHTML = "";
      for (let i = 0; i < 81; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        const value = puzzle[i];
        const row = Math.floor(i / 9);
        const col = i % 9;
        cell.dataset.index = i;
        if (value !== 0) {
          cell.textContent = value;
          cell.classList.add("fixed");
        } else {
          cell.onclick = () => selectCell(i);
        }
        board.appendChild(cell);
      }

      // 렌더 넘버패드
      const numpad = document.getElementById("numpad");
      numpad.innerHTML = "";
      for (let n = 1; n <= 9; n++) {
        const btn = document.createElement("div");
        btn.textContent = n;
        btn.className = "num-button";
        btn.onclick = () => fillNumber(n);
        numpad.appendChild(btn);
      }
    }

    function selectCell(index) {
      const board = document.getElementById("board").children;
      if (selectedCell !== null) {
        board[selectedCell].classList.remove("selected-cell");
      }
      selectedCell = index;
      board[selectedCell].classList.add("selected-cell");
    }

    function fillNumber(num) {
      if (selectedCell === null || puzzle[selectedCell] !== 0) return;

      const correct = answer[selectedCell] === num;
      const board = document.getElementById("board").children[selectedCell];

      if (correct) {
        board.textContent = num;
        board.classList.add(`claimed-${myColor}`);
        board.onclick = null;
        puzzle[selectedCell] = num;
        correctCount++;
        updateScore();
        console.log(`정답! ${selectedCell} → ${num} (${correctCount})`);

        if (correctCount >= 9) {
          console.log("🌀 다음 퍼즐로 교체합니다.");
          correctCount = 0;
          startGame(currentDifficulty);  // 유지된 난이도로 새 퍼즐
        }
      } else {
        console.log("❌ 오답입니다.");
      }

      selectedCell = null;
    }

    function updateScore() {
      document.getElementById("score").textContent =
        puzzle.filter(n => n !== 0).length;
    }
  </script>
</body>
</html>
